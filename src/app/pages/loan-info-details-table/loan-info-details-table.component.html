<div class="loan-dashboard">
    <!-- Error or No Data State -->
    <div *ngIf="hasError || !hasData" class="error-container">
      <app-data-not-found 
        [message]="errorMessage || 'No customer data found'"
        icon="error_outline"
        [showAction]="true"
        actionLabel="Retry"
        [actionRoute]="''">
      </app-data-not-found>
      <div class="retry-button-container">
        <button mat-raised-button color="primary" (click)="retryLoad()">
          <mat-icon>refresh</mat-icon>
          Retry
        </button>
      </div>
    </div>

    <!-- Data Display -->
    <div *ngIf="hasData && !hasError">
      <!-- Status Cards -->
      <div class="status-cards">
        <div class="status-card loan" (click)="changeStatusFilter('All')">
          <div class="status-title">All Applications</div>
          <div class="status-count">{{ loanCount }}</div>
        </div>
        <div class="status-card approved" (click)="changeStatusFilter('Approved')">
          <div class="status-title">Approved</div>
          <div class="status-count">{{ approvedCount }}</div>
        </div>
        <div class="status-card rejected" (click)="changeStatusFilter('Rejected')">
          <div class="status-title">Rejected</div>
          <div class="status-count">{{ rejectedCount }}</div>
        </div>
        <div class="status-card disbursed" (click)="changeStatusFilter('Disbursed')">
          <div class="status-title">Disbursed</div>
          <div class="status-count">{{ disbursedCount }}</div>
        </div>
        <div class="status-card abandoned" (click)="changeStatusFilter('Abandoned')">
          <div class="status-title">Abandoned</div>
          <div class="status-count">{{ abandonedCount }}</div>
        </div>
      </div>
    
      <!-- Filter Row -->
      <div class="filter-row">
        <button class="new-lead-btn" (click)="addNewLoan()">+ New Lead</button>
        <input type="text" [(ngModel)]="filterText" placeholder="Search by name or ID..." />
      </div>
    
      <!-- Table -->
      <div *ngIf="filteredLoans.length > 0; else noFilteredResults">
        <table class="loan-table">
          <thead>
            <tr>
              <th>Loan App No</th>
              <th>Customer ID</th>
              <th>Name</th>
              <th>Lead Product</th>
              <th>Amount Requested</th>
              <th>Workflow Stage</th>
              <th>Sourcing Channel</th>
              <th>Anchor</th>
              <th>Office</th>
              <th>Loan Product</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let loan of pagedLoans">
              <td>{{ loan.loanAppNo }}</td>
              <td>{{ loan.id }}</td>
              <td>{{ loan.name }}</td>
              <td>{{ loan.leadProduct }}</td>
              <td>{{ loan.amountRequested | currency }}</td>
              <td>{{ loan.workflowStage }}</td>
              <td>{{ loan.sourcingChannel }}</td>
              <td>{{ loan.anchor }}</td>
              <td>{{ loan.office }}</td>
              <td>{{ loan.loanProduct }}</td>
              <td>{{ loan.status }}</td>
              <td>
                <button (click)="editLoan(loan)">Edit</button>
                <button (click)="deleteLoan(loan.id)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      
        <!-- Pagination -->
        <div class="pagination-controls" *ngIf="totalPages > 1">
          <button (click)="prevPage()" [disabled]="currentPage === 1">« Prev</button>
          <span>Page {{ currentPage }} of {{ totalPages }}</span>
          <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next »</button>
        </div>
      </div>

      <!-- No Filtered Results -->
      <ng-template #noFilteredResults>
        <app-data-not-found 
          message="No results match your search criteria"
          icon="search_off">
        </app-data-not-found>
      </ng-template>
    </div>
  </div>
  