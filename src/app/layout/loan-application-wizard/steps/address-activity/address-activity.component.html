<div class="address-container" *ngIf="formLoaded">
  <!-- Saved Addresses View -->
  <div *ngIf="addressList.length > 0 && !isEditable" class="addresses-view">
    <div class="section-header">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>home</mat-icon>
        </div>
        <div class="header-text">
          <h2>Address Details</h2>
          <p class="header-subtitle">Manage your residential and correspondence addresses</p>
        </div>
      </div>
      <button mat-raised-button color="primary" class="add-btn" (click)="addNew()">
        <mat-icon>add_circle</mat-icon>
        Add New Address
      </button>
    </div>

    <div class="address-cards-grid">
      <div *ngFor="let addr of addressList; let i = index" class="address-card">
        <div class="card-header">
          <div class="address-type-badge">
            <mat-icon>{{ addr.addressType === 'Current' ? 'home' : 'location_on' }}</mat-icon>
            <span>{{ addr.addressType || 'Address' }} {{ i + 1 }}</span>
          </div>
          <div class="ownership-tag" [ngClass]="{'own': addr.ownership === 'Own', 'rented': addr.ownership === 'Rented'}">
            {{ addr.ownership || 'N/A' }}
          </div>
        </div>

        <div class="card-content">
          <div class="address-block">
            <div class="address-icon">
              <mat-icon>place</mat-icon>
            </div>
            <div class="address-text">
              <p class="address-line">{{ addr.addressLine1 || '' }}</p>
              <p class="address-line" *ngIf="addr.addressLine2">{{ addr.addressLine2 }}</p>
              <p class="address-line" *ngIf="addr.landmark">Near {{ addr.landmark }}</p>
              <p class="address-location">
                {{ addr.village || '' }}{{ addr.village && addr.district ? ', ' : '' }}{{ addr.district || '' }}
              </p>
              <p class="address-region">
                {{ addr.state || '' }}{{ addr.state && addr.pincode ? ' - ' : '' }}{{ addr.pincode || '' }}
              </p>
              <p class="address-country">{{ addr.country || 'India' }}</p>
            </div>
          </div>

          <div class="residence-info">
            <mat-icon>schedule</mat-icon>
            <span>{{ addr.yearsOfResidence || 0 }} years at this residence</span>
          </div>
        </div>

        <div class="card-footer">
          <button mat-stroked-button color="primary" class="action-btn edit-btn" (click)="editAddress(addr)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-stroked-button color="warn" class="action-btn delete-btn" (click)="deleteAddress(addr)">
            <mat-icon>delete_outline</mat-icon>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="addressList.length === 0 && !isEditable" class="empty-state">
    <div class="empty-icon">
      <mat-icon>add_location_alt</mat-icon>
    </div>
    <h3>No Addresses Added</h3>
    <p>Start by adding your current residential address</p>
    <button mat-raised-button color="primary" (click)="addNew()">
      <mat-icon>add_circle</mat-icon>
      Add First Address
    </button>
  </div>

  <!-- Address Form -->
  <div *ngIf="isEditable" class="form-view">
    <div class="section-header compact">
      <div class="header-content">
        <div class="header-icon">
          <mat-icon>edit_location_alt</mat-icon>
        </div>
        <div class="header-text">
          <h2>{{ selectedEditId ? 'Edit Address' : 'Add New Address' }}</h2>
          <p class="header-subtitle">Fill in the address details below</p>
        </div>
      </div>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="address-form">
      <!-- Address Type Section -->
      <div class="form-section">
        <div class="section-title">
          <mat-icon>category</mat-icon>
          <span>Address Classification</span>
        </div>
        <div class="form-row two-cols">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Address Type</mat-label>
            <mat-select formControlName="addressType">
              <mat-option *ngFor="let type of addressTypeOptions" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>label</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Ownership Status</mat-label>
            <mat-select formControlName="ownership">
              <mat-option *ngFor="let option of ownershipOptions" [value]="option">
                {{ option }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>house</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Address Details Section -->
      <div class="form-section">
        <div class="section-title">
          <mat-icon>location_on</mat-icon>
          <span>Address Information</span>
        </div>
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Address Line 1</mat-label>
            <input matInput formControlName="addressLine1" placeholder="House/Flat No., Building Name, Street" />
            <mat-icon matPrefix>home</mat-icon>
          </mat-form-field>
        </div>
        <div class="form-row two-cols">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Address Line 2</mat-label>
            <input matInput formControlName="addressLine2" placeholder="Colony, Area, Sector (Optional)" />
            <mat-icon matPrefix>apartment</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Landmark</mat-label>
            <input matInput formControlName="landmark" placeholder="Near famous place" />
            <mat-icon matPrefix>near_me</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Location Section -->
      <div class="form-section">
        <div class="section-title">
          <mat-icon>map</mat-icon>
          <span>Location Details</span>
        </div>
        <div class="form-row three-cols">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Village/Town/City</mat-label>
            <input matInput formControlName="village" placeholder="City name" />
            <mat-icon matPrefix>location_city</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>District</mat-label>
            <input matInput formControlName="district" placeholder="District name" />
            <mat-icon matPrefix>terrain</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>State</mat-label>
            <mat-select formControlName="state">
              <mat-option *ngFor="let state of indianStates" [value]="state">
                {{ state }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>public</mat-icon>
          </mat-form-field>
        </div>
        <div class="form-row three-cols">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Pincode</mat-label>
            <input matInput formControlName="pincode" maxlength="6" placeholder="6-digit pincode" pattern="[0-9]{6}" />
            <mat-icon matPrefix>pin_drop</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Country</mat-label>
            <mat-select formControlName="country">
              <mat-option value="India">India</mat-option>
            </mat-select>
            <mat-icon matPrefix>flag</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Years at Residence</mat-label>
            <input matInput type="number" formControlName="yearsOfResidence" placeholder="0" min="0" />
            <mat-icon matPrefix>calendar_today</mat-icon>
          </mat-form-field>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button mat-stroked-button type="button" class="cancel-btn" (click)="isEditable = false; loadAddresses()">
          <mat-icon>close</mat-icon>
          Cancel
        </button>
        <button mat-raised-button color="primary" type="submit" class="save-btn">
          <mat-icon>check_circle</mat-icon>
          Save Address
        </button>
      </div>
    </form>
  </div>
</div>
