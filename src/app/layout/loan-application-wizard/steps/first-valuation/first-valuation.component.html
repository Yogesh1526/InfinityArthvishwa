<div class="jewellery-wrapper">
  <!-- Form Section -->
  <form class="jewellery-form" [formGroup]="jewelleryForm">
    <div class="form-grid">
      <mat-form-field appearance="outline">
        <mat-label>Name</mat-label>
        <input matInput formControlName="jewelleryName" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Quantity</mat-label>
        <input matInput type="number" formControlName="quantity" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Gross Weight</mat-label>
        <input matInput type="number" formControlName="grossWeight" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Stone Weight</mat-label>
        <input matInput type="number" formControlName="stoneWeight" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Net Weight</mat-label>
        <input matInput type="number" formControlName="netWeight" readonly />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Karat</mat-label>
        <mat-select formControlName="karat">
          <mat-option *ngFor="let k of karatOptions" [value]="k.value">
            {{ k.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Purity (%)</mat-label>
        <input matInput type="number" formControlName="purity" />
        <mat-error *ngIf="purityError">{{ purityError }}</mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Net Purity Weight</mat-label>
        <input matInput type="number" formControlName="netPurityWeight" readonly />
      </mat-form-field>
    </div>

    <!-- Action Buttons -->
    <div class="button-row">
      <button mat-flat-button color="primary" (click)="addJewellery()">+ Add Jewellery</button>
      <input type="file" hidden #imageInput (change)="uploadImage($event)" accept="image/*" />
      <button mat-stroked-button color="accent" (click)="imageInput.click()">Upload Consolidated Image</button>
    </div>
  </form>

  <!-- Jewellery Table -->
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z4 full-width-table">
    <ng-container matColumnDef="jewelleryName">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let element">{{ element.jewelleryName }}</td>
    </ng-container>

    <ng-container matColumnDef="quantity">
      <th mat-header-cell *matHeaderCellDef>Qty</th>
      <td mat-cell *matCellDef="let element">{{ element.quantity }}</td>
    </ng-container>

    <ng-container matColumnDef="grossWeight">
      <th mat-header-cell *matHeaderCellDef>Gross Wt</th>
      <td mat-cell *matCellDef="let element">{{ element.grossWeight }}</td>
    </ng-container>

    <ng-container matColumnDef="stoneWeight">
      <th mat-header-cell *matHeaderCellDef>Stone Wt</th>
      <td mat-cell *matCellDef="let element">{{ element.stoneWeight }}</td>
    </ng-container>

    <ng-container matColumnDef="netWeight">
      <th mat-header-cell *matHeaderCellDef>Net Wt</th>
      <td mat-cell *matCellDef="let element">{{ element.netWeight }}</td>
    </ng-container>

    <ng-container matColumnDef="karat">
      <th mat-header-cell *matHeaderCellDef>Karat</th>
      <td mat-cell *matCellDef="let element">{{ element.karat }}</td>
    </ng-container>

    <ng-container matColumnDef="purity">
      <th mat-header-cell *matHeaderCellDef>Purity %</th>
      <td mat-cell *matCellDef="let element">{{ element.purity }}</td>
    </ng-container>

    <ng-container matColumnDef="netPurityWeight">
      <th mat-header-cell *matHeaderCellDef>Net Purity Wt</th>
      <td mat-cell *matCellDef="let element">{{ element.netPurityWeight }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    <!-- Total Row -->
    <tr class="total-row" *ngIf="jewelleryList.length > 0">
      <td colspan="2">Total:</td>
      <td>{{ getTotal('grossWeight') }}</td>
      <td>{{ getTotal('stoneWeight') }}</td>
      <td>{{ getTotal('netWeight') }}</td>
      <td></td>
      <td>{{ getTotal('purity') }}</td>
      <td>{{ getTotal('netPurityWeight') }}</td>
    </tr>
  </table>

  <!-- Image Preview -->
  <div *ngIf="uploadedImageUrl" class="image-preview">
    <h4>Uploaded Image Preview:</h4>
    <img [src]="uploadedImageUrl" alt="Consolidated Image" />
  </div>

  <!-- Final Submit -->
  <div class="button-row">
    <button mat-raised-button color="accent" (click)="submitAll()" [disabled]="jewelleryList.length === 0">
      ðŸš€ Submit All
    </button>
  </div>
</div>
